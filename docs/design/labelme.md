# 图像标注工具需求文档

## 项目概述

开发一个基于网页的图像标注工具，类似于 labelme，用于标注图像并将标注数据发送到 Django 后端进行处理和存储。该工具将支持多种标注形状，允许用户选择标注所属的系统，并提供高级图像处理功能。

## 功能需求

### 图像上传和显示
- 允许用户一次上传多个图像文件
- 显示已上传的文件列表
- 在canvas上显示选中的图像
- 支持图像缩放和平移
- 点击不同文件时自动保存当前标注并跳转到对应文件的标注

### 标注功能
- 支持以下标注形状：
  - 矩形
  - 多边形
  - 折线
  - 点
- 允许用户为每个标注添加标签
- 支持编辑现有标注（移动、调整大小、删除）
- 提供撤销功能以删除最后一个顶点（适用于多边形和折线）

### 用户界面
- 提供侧边栏菜单，包含以下选项：
  - 图像上传
  - 缩放控制
  - 形状选择工具
  - 编辑模式切换
  - 标签显示切换
  - 删除选中形状
  - 提交标注
- 在画布上显示当前缩放级别
- 在编辑模式下显示标注标签
- 显示已上传文件的列表，支持点击切换

### 标注数据管理
- 允许用户查看所有创建的标注
- 支持选择和取消选择标注
- 提供删除选定标注的功能，并在删除前显示确认对话框
- 在切换文件时自动保存当前文件的标注

### 与后端通信
- 实现与 Django 后端的通信功能
- 在提交标注时，弹出对话框让用户选择当前标注所属的系统
- 将标注数据（包括图像和标注信息）发送到后端
- 接收并显示后端的响应消息

### 高级图像处理(TODO, add resize, rotate? but this does not require annotation)
- 添加 Artifacts 菜单栏，包含以下选项：
  1. 裁剪图片
     - 让用户选择一个已标注的区域标签
     - 发送图片和选定区域到后端
     - 接收处理后的图片并在文件列表中显示为新的 artifact
  2. 畸变矫正
     - 让用户选择一个用于畸变矫正的标签
     - 发送图片和选定区域到后端
     - 接收处理后的图片并在文件列表中显示为新的 artifact
  3. 透视变换
     - 让用户选择一个用于透视变换的标签
     - 发送图片和选定区域到后端
     - 接收处理后的图片并在文件列表中显示为新的 artifact
- 允许用户使用生成的 artifact 图片进行进一步标注

## 技术要求

### 前端
- 使用 Vue.js 框架开发
- 使用 Element UI 组件库
- 使用 HTML5 Canvas 进行图像显示和标注
- 使用 Axios 进行 HTTP 请求

### 后端
- 使用 Django 框架
- 实现 API 端点以接收和处理标注数据
- 根据标注所属的系统进行相应的处理和存储
- 实现图像处理功能，包括裁剪、畸变矫正和透视变换

## 数据模型

### 标注数据结构
```javascript
{
  type: String, // 'rectangle', 'polygon', 'polyline', 'point'
  points: Array, // 形状的坐标点
  label: String, // 用户定义的标签
  system: String, // 标注所属的系统
  fileId: String // 关联的文件ID
}
```

### 文件数据结构
```javascript
{
  id: String,
  name: String,
  type: String, // 'original' 或 'artifact'
  parentId: String, // 如果是 artifact，则指向原始图片的 ID
  artifactType: String // 'crop', 'undistort', 或 'perspective'
}
```

## 用户体验

- 提供直观的用户界面，易于理解和使用
- 实现流畅的标注体验，包括实时绘制和编辑
- 提供清晰的视觉反馈，如悬停效果和选中状态
- 在进行重要操作（如删除标注或提交数据）时显示确认对话框
- 确保文件列表和图像处理操作的响应迅速

## 安全性

- 实现适当的用户认证和授权机制
- 在前端和后端都进行数据验证
- 确保安全的文件上传处理

## 性能

- 优化大型图像和多个文件的加载和显示
- 确保标注操作的响应速度，特别是在处理复杂的多边形时
- 优化文件切换和自动保存的性能

## 扩展性

- 设计模块化的代码结构，便于未来添加新的标注类型或功能
- 考虑支持多语言本地化
- 设计灵活的图像处理管线，便于添加新的图像处理功能

## 测试

- 开发单元测试和集成测试
- 进行跨浏览器兼容性测试
- 执行用户验收测试
- 测试多文件上传和处理场景
- 测试各种图像处理功能的正确性和性能

## 文档

- 提供用户使用手册，包括新增的文件管理和图像处理功能
- 编写技术文档，包括 API 规范和部署指南
- 提供图像处理功能的使用说明和最佳实践